function isIgnored(){return"1"===$("h2 > #star-name[data-star-ignore]").attr("data-star-ignore")}function ignoreStar(){ajax("ajax/ignoreStar.php",`starID=${starID}`)}function enableStar(){ajax("ajax/enableStar.php",`starID=${starID}`)}function addStarImage(e,t){let a=getExtension(pathToFname(t));ajax("ajax/add_star_image.php",`id=${e}&image=${t}`,function(e){let t=document.getElementById("dropbox"),n=document.createElement("img");n.src=`images/stars/${starID}.${a}?v=${e.responseText}`,insertBefore(t,n),t.remove()})}function removeStarImage(e){ajax("ajax/remove_star_image.php",`id=${e}`)}function deleteStar(e){ajax("ajax/remove_star.php",`starID=${e}`)}function renameStar(e,t){ajax("ajax/rename_star.php","starID="+e+"&starName="+t)}function addStarAlias(e){ajax("ajax/addStarAlias.php","starID="+starID+"&aliasName="+e)}function removeStarAlias(e){ajax("ajax/removeStarAlias.php","aliasID="+e)}function removeVideoStar(e){ajax("ajax/remove_videostar.php","videoID="+e+"&starID="+starID)}function aliasSwapTitle(e){ajax("ajax/alias_swap_title.php",`aliasID=${e}&starID=${starID}`)}function ajax(e,t,a=function(){location.href=location.href}){let n=`${e}?${t}`,o=new XMLHttpRequest;o.open("GET",n),o.send(),o.onreadystatechange=function(){4===this.readyState&&200===this.status&&a(this)}}function dropbox(){const e=document.getElementById("dropbox");function t(e){e.stopPropagation(),e.preventDefault()}e&&(e.addEventListener("dragenter",t,!1),e.addEventListener("dragexit",t,!1),e.addEventListener("dragover",t,!1),e.addEventListener("drop",function(e){let a=e.dataTransfer.getData("text");t(e),addStarImage(starID,imageWithoutParameter(a))},!1))}function imageWithoutParameter(e){let t=e.lastIndexOf(".");if(t>-1){let a=-1;for(let n=t;n<e.length;n++)if("?"===e[n]){a=n;break}if(a>-1){let t="";for(let n=0;n<a;n++)t+=e[n];return t}return e}return e}function hasNoVideos(){return!$(".video").length}function autoComplete(){let e=[],t=[],a=[],n=[],o=[],i=[],r=[];const s=$(".breast"),d=$(".eye"),l=$(".hair"),u=$(".ethnicity"),c=$(".country"),m=$(".start"),f=$(".end");for(let t=0;t<s.length;t++)e.push(s.eq(t).text());for(let e=0;e<d.length;e++)t.push(d.eq(e).text());for(let e=0;e<l.length;e++)a.push(l.eq(e).text());for(let e=0;e<u.length;e++)n.push(u.eq(e).text());for(let e=0;e<c.length;e++)o.push(c.eq(e).text());for(let e=0;e<m.length;e++)i.push(m.eq(e).text());for(let e=0;e<f.length;e++)r.push(f.eq(e).text());$("input[name='breast']").autocomplete({source:[e]}),$("input[name='eye']").autocomplete({source:[t]}),$("input[name='hair']").autocomplete({source:[a]}),$("input[name='ethnicity']").autocomplete({source:[n]}),$("input[name='country']").autocomplete({source:[o]}),$("input[name='height']").autocomplete({source:[]}),$("input[name='weight']").autocomplete({source:[]}),$("input[name='birthdate']").autocomplete({source:[]}),$("input[name='start']").autocomplete({source:[i]}),$("input[name='end']").autocomplete({source:[r]})}function setFocus(){let e=$("form").find("input").closest("form"),t=$(e).length;for(let a=t-1;a>=0;a--){if(""!==$(e).eq(a).find("input")[0].value){a<t-1?$(e).eq(a+1).find("input")[0].focus():$(e).eq(a).find("input")[0].focus();break}if(!a){$(e).eq(a).find("input")[0].focus();break}}}function isPlaying(e=1){return!video[e].paused}function goToAndStop(e,t=startTime){video[e].currentTime=t,isPlaying(e)&&video[e].pause()}function goToAndPlay(e,t=0){video[e].currentTime=t,isPlaying(e)||video[e].play()}function videoHover(){let e;for(let e=0;e<video.length;e++)video[e].addEventListener("loadedmetadata",function(){this.currentTime=startTime}),video[e].addEventListener("mouseenter",function(){t(e)}),video[e].addEventListener("mouseleave",function(){a(e)});function t(a){let n=120;goToAndPlay(a,n+=startTime),e=setInterval(function(){(n+=120)>video[a].duration&&(clearInterval(e),t(a)),goToAndPlay(a,n)},1500)}function a(t){goToAndStop(t),clearInterval(e)}}function pathToFname(e){return e.substr(e.lastIndexOf("/")+1)}function getExtension(e){return e.substr(e.lastIndexOf(".")+1)}function insertBefore(e,t){e.parentNode.insertBefore(t,e)}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("star-name");window.starName=document.getElementById("star-name").textContent,window.starID=window.location.href.split("id=")[1],window.video=document.getElementsByTagName("video"),window.startTime=40,dropbox(),autoComplete();let t=document.getElementsByTagName("form");for(let e=0;e<t.length;e++)t[e].addEventListener("keydown",function(a){switch(a.keyCode){case 13:$(t).eq(e).submit();break;case 9:a.preventDefault(),e<t.length-1?$(t).eq(e+1).find("input")[0].focus():$("#next")[0].click()}});setFocus(),videoHover(),isIgnored()&&e.classList.add("ignored"),1===$(".ribbon-green").length&&alert("Warning!")}),$(function(){$.contextMenu({selector:"#star > img",items:{delete_image:{name:"Delete Image",icon:"delete",callback:function(){removeStarImage(starID)}}}})}),$(function(){$.contextMenu({selector:"#star > #dropbox",items:{delete_star:{name:"Delete Star",icon:"delete",callback:function(){deleteStar(starID)},disabled:!hasNoVideos()}}})}),$(function(){$.contextMenu({selector:"#star #star-name",zIndex:2,items:{rename:{name:"Rename",icon:"rename",callback:function(){const e=document.createElement("div");e.id="dialog",e.title="Edit Star",document.body.appendChild(e),$(function(){const e=$("#dialog");e.dialog({close:function(){this.closest(".ui-dialog").remove()},width:250});const t=document.createElement("input");t.type="text",t.name="starName_edit",t.value=$("#star > h2 > #star-name").text(),t.setAttribute("autofocus",""),e.append(t);let a=$("input[name='starName_edit']"),n=a.val().length;a[0].focus(),a[0].setSelectionRange(n,n),document.querySelector("input[name='starName_edit']").addEventListener("keydown",function(e){13===e.keyCode&&renameStar(starID,this.value.trim())})})}},add_alias:{name:"Add Alias",callback:function(){const e=document.createElement("div");e.id="dialog",e.title="Add Alias",document.body.appendChild(e),$(function(){const e=$("#dialog");e.dialog({close:function(){this.closest(".ui-dialog").remove()},width:250});const t=document.createElement("input");t.type="text",t.name="starName_alias",t.setAttribute("autofocus",""),e.append(t),document.querySelector("input[name='starName_alias']").addEventListener("keydown",function(e){13===e.keyCode&&addStarAlias(this.value)})})}},ignore_star:{name:"Ignore Star",callback:function(){ignoreStar()},visible:!isIgnored()},enable_star:{name:"Enable Star",callback:function(){enableStar()},visible:isIgnored()}}})}),$(function(){$.contextMenu({selector:"#star .alias",zIndex:2,items:{edit_alias:{name:"Remove Alias",callback:function(e,t){removeStarAlias(t.$trigger.attr("data-alias-id"))}},swap_alias_and_title:{name:"Make Default",callback:function(e,t){aliasSwapTitle(t.$trigger.attr("data-alias-id"))}}}})}),$(function(){$.contextMenu({selector:".video",items:{remove_star:{name:"Remove",icon:"delete",callback:function(e,t){removeVideoStar(t.$trigger.attr("href").split("id=")[1])}}}})});