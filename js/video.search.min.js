document.addEventListener("DOMContentLoaded",function(){const label_input=document.getElementsByTagName("label");const sort_radio=document.querySelectorAll('input[name="sort"]');const title_input=document.querySelector('input[name="title"]');const star_input=document.querySelector('input[name="star"]');const website_select=document.querySelector("#websites > select");const category_checkbox=document.querySelectorAll('input[name^="category_"]');const attributes_checkbox=document.querySelectorAll('input[name^="attribute_"]');const locations_checkbox=document.querySelectorAll('input[name^="location_"]');const existing_checkbox=document.querySelector('input[name="existing"]');const loader=document.getElementById("loader");const updBtn=document.getElementById("update");function daysToYears(days){return Math.floor(days/365)}$("select.pretty").prettyDropdown({height:30,classic:true,hoverIntent:1e3});const loadData=function(){fetch("json/video.search.php").then(function(jsonData){return jsonData.json()}).then(function(data){let wrapper=document.getElementById("videos");let elem=data["videos"];for(let i=0;i<elem.length;i++){let md5=elem[i]["md5"];let thumbnail=elem[i]["thumbnail"];let existing=elem[i]["existing"];let videoID=elem[i]["videoID"];let videoName=elem[i]["videoName"];let videoDate=elem[i]["videoDate"];let websiteName=elem[i]["websiteName"];let ageInVideo=parseInt(elem[i]["ageInVideo"]);let star=elem[i]["star"];let category=elem[i]["category"];if(!category.length)category.push("0");let attribute=elem[i]["attribute"];if(!attribute.length)attribute.push("0");let location=elem[i]["location"];if(!location.length)location.push("0");let a=document.createElement("a");a.classList.add("video","ribbon-container");a.setAttribute("href","video.php?id="+videoID);a.setAttribute("data-video-id",videoID);a.setAttribute("data-video-date",videoDate);a.setAttribute("data-ageinvideo",ageInVideo.toString());a.setAttribute("data-title",videoName);a.setAttribute("data-star",star);a.setAttribute("data-website",websiteName);a.setAttribute("data-existing",existing);a.setAttribute("data-category-name",'["'+category+'"]');a.setAttribute("data-attribute-name",'["'+attribute+'"]');a.setAttribute("data-location-name",'["'+location+'"]');let img=document.createElement("img");img.classList.add("lazy");img.setAttribute("data-src",thumbnail+"?v="+md5);let span=document.createElement("span");span.classList.add("title");span.textContent=videoName;a.appendChild(img);a.appendChild(span);if(ageInVideo){let ribbon=document.createElement("span");ribbon.classList.add("ribbon");ribbon.textContent=daysToYears(ageInVideo);a.appendChild(ribbon)}wrapper.appendChild(a)}}).then(function(){loader.remove();window.video=document.getElementsByClassName("video");window.video_query=document.querySelectorAll(".video");window.videoLength=video.length;window.$video=$(video)}).then(function(){for(let i=0;i<label_input.length;i++){label_input[i].addEventListener("click",function(){$(label_input[i].previousSibling).click()})}title_input.addEventListener("keydown",function(){setTimeout(function(){let input=title_input.value.toLowerCase();$video.removeClass("hidden-title");if(input!==""){$video.not(function(){return this.getAttribute("data-title").toLowerCase().indexOf(input)>-1}).addClass("hidden-title")}})});star_input.addEventListener("keydown",function(){setTimeout(function(){let input=star_input.value.toLowerCase();$video.removeClass("hidden-star");if(input!==""){$video.not(function(){return this.getAttribute("data-star").toLowerCase().indexOf(input)>-1}).addClass("hidden-star")}})});existing_checkbox.addEventListener("change",function(){$video.removeClass("hidden-existing");if(this.checked){for(let i=0;i<videoLength;i++){if(video[i].getAttribute("data-existing")==="0"){video[i].classList.add("hidden-existing")}}}});if(website_select){const prettyWebsite_select=document.querySelectorAll("#websites > .prettydropdown");$(prettyWebsite_select).on("change",function(){$video.removeClass("hidden-website");let selectedWebsite=website_select.options[website_select.selectedIndex].textContent;for(let i=0;i<videoLength;i++){if(video[i].getAttribute("data-website")!==selectedWebsite&&selectedWebsite!=="All"){video[i].classList.add("hidden-website")}}})}for(let i=0,wrapperLen=category_checkbox.length;i<wrapperLen;i++){category_checkbox[i].addEventListener("change",function(){category_checkbox[i].parentElement.classList.toggle("selected");let category=this.name.split("category_").pop();let category_class=category.replace(/ /g,"-");for(let j=0;j<videoLength;j++){let category_arr=video[j].getAttribute("data-category-name").slice(2,-2).split(",");for(let k=0,len=category_arr.length;k<len;k++){if(this.checked){if(category==="NULL"&&len===1&&category_arr[k]==="0"){video[j].classList.add("tmp")}else if(category_arr[k]===category){video[j].classList.add("tmp")}}}}if(this.checked)$video.not(".tmp").addClass("hidden-category-"+category_class);else $video.removeClass("hidden-category-"+category_class);$video.removeClass("tmp")})}for(let i=0,wrapperLen=attributes_checkbox.length;i<wrapperLen;i++){attributes_checkbox[i].addEventListener("change",function(){attributes_checkbox[i].parentElement.classList.toggle("selected");let attribute=this.name.split("attribute_").pop();let attribute_class=attribute.replace(/ /g,"-");for(let j=0;j<videoLength;j++){let attribute_arr=video[j].getAttribute("data-attribute-name").slice(2,-2).split(",");for(let k=0,len=attribute_arr.length;k<len;k++){if(this.checked&&attribute_arr[k]===attribute){video[j].classList.add("tmp")}}}if(this.checked)$video.not(".tmp").addClass("hidden-attribute-"+attribute_class);else $video.removeClass("hidden-attribute-"+attribute_class);$video.removeClass("tmp")})}for(let i=0,wrapperLen=locations_checkbox.length;i<wrapperLen;i++){locations_checkbox[i].addEventListener("change",function(){locations_checkbox[i].parentElement.classList.toggle("selected");let location=this.name.split("location_").pop();let location_class=location.replace(/ /g,"-");for(let j=0;j<videoLength;j++){let location_arr=video[j].getAttribute("data-location-name").slice(2,-2).split(",");for(let k=0,len=location_arr.length;k<len;k++){if(this.checked&&location_arr[k]===location){video[j].classList.add("tmp")}}}if(this.checked)$video.not(".tmp").addClass("hidden-location-"+location_class);else $video.removeClass("hidden-location-"+location_class);$video.removeClass("tmp")})}for(let i=0;i<sort_radio.length;i++){sort_radio[i].addEventListener("change",function(){$(sort_radio).parent().removeClass("selected");sort_radio[i].parentElement.classList.add("selected");let label=this.id;let alphabetically=function(a,b){return a.querySelector("span").innerHTML.toLowerCase().localeCompare(b.querySelector("span").innerHTML.toLowerCase(),"en")};let alphabetically_reverse=function(a,b){return b.querySelector("span").innerHTML.toLowerCase().localeCompare(a.querySelector("span").innerHTML.toLowerCase(),"en")};let added=function(a,b){return a.getAttribute("data-video-id")-b.getAttribute("data-video-id")};let added_reverse=function(a,b){return b.getAttribute("data-video-id")-a.getAttribute("data-video-id")};let actor_age=function(a,b){return a.getAttribute("data-ageinvideo")-b.getAttribute("data-ageinvideo")};let actor_age_reverse=function(a,b){return b.getAttribute("data-ageinvideo")-a.getAttribute("data-ageinvideo")};let video_date=function(a,b){return new Date(a.getAttribute("data-video-date"))-new Date(b.getAttribute("data-video-date"))};let video_date_reverse=function(a,b){return new Date(b.getAttribute("data-video-date"))-new Date(a.getAttribute("data-video-date"))};switch(label){case"alphabetically":$video.sort(alphabetically);break;case"alphabetically_desc":$video.sort(alphabetically_reverse);break;case"added":$video.sort(added);break;case"added_desc":$video.sort(added_reverse);break;case"date":$video.sort(video_date);break;case"date_desc":$video.sort(video_date_reverse);break;case"actor-age":$video.sort(actor_age);break;case"actor-age_desc":$video.sort(actor_age_reverse);break;default:console.log("No sort method for: "+label)}for(let i=0;i<videoLength;i++){$video[i].parentNode.appendChild($video[i])}})}}).then(function(){new LazyLoad({elements_selector:".lazy",threshold:300})})};loadData();updBtn.addEventListener("click",function(){resetData();loadData()})});function resetData(){$(".video").remove()}